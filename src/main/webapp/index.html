<html>
  <head>
    <title>Record Collection</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="jquery.cookie.js"></script>
    <link rel="stylesheet" type="text/css" href="rcstyle.css">
  </head>
  <body>
    <div class="wrapper">
      <button class="button" id="button">Login to Discogs</button>
    </div>
    <script>
      function get(url) {
        var request = new XMLHttpRequest();
        request.open('GET', url, false);  // `false` makes the request synchronous
        request.send();
        return JSON.parse(request.responseText);
      }

      function getQueryParams() {
        qs = document.location.search.split('+').join(' ');

        var params = {},
        tokens,
        re = /[?&]?([^=]+)=([^&]*)/g;

        while (tokens = re.exec(qs)) {
          params[decodeURIComponent(tokens[1])] = decodeURIComponent(tokens[2]);
        }

        return params;
      }
      
      $( document ).ready(function() {
      
        //Check to see if we're being asked to refresh the cookie
        if (getQueryParams()["reauth"]) {
          $.removeCookie('access_token');
        }
      
      //See if we have an access token
        if ($.cookie('access_token')) {
          window.location.href = "me.html";
        }

        //See if there's a token in the URL
        if (getQueryParams()["token"]) {
          var token = getQueryParams()["token"];
      $.cookie('access_token',token,{ expires: 7, path: '/' });
          window.location.href = "/";
        }
      
        //Login to discogs on click
        $("#button").click(function() {
          window.location.href = get("/endpoint/login")["redirect"];
        });

      });
  </script>
  </body>
</html>
